<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Login - Programming Upload</title>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 50px;
      background: #f4f4f4;
      margin: 0;
    }

    .box {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 420px;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    button {
      background: black;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background: #333;
    }

    #message, #uploadMessage {
      text-align: center;
      margin-top: 5px;
      font-size: 14px;
    }

    #uploadUI {
      display: none;
    }

    #imageDisplay img {
      display: block;
      width: 100%;
      height: auto;
      margin-top: 15px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<div class="box">

  <!-- LOGIN UI -->
  <div id="loginUI">
    <h2>Admin Login</h2>
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button onclick="login()">Log In</button>
    <div id="message"></div>
  </div>

  <!-- UPLOAD UI -->
  <div id="uploadUI">
    <h2>Upload Programming PNG</h2>
    <input type="file" id="imageInput" accept="image/png">
    <button onclick="uploadImage()">Upload PNG</button>
    <div id="uploadMessage"></div>
    <div id="imageDisplay"></div>
  </div>

</div>

<script>
  // --- Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyCGnRRcRQOVWdloCg6-PSj2l4EDnR-CzqI",
    authDomain: "campagqtest-754b1.firebaseapp.com",
    projectId: "campagqtest-754b1",
    storageBucket: "campagqtest-754b1.firebasestorage.app",
    messagingSenderId: "378599524521",
    appId: "1:378599524521:web:0d8ea66ccee8e7349b41b8"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const storage = firebase.storage();

  // --- LOGIN ---
  function login() {
    const usernameInput = document.getElementById("username").value.trim().toLowerCase();
    const password = document.getElementById("password").value;
    const message = document.getElementById("message");

    if (!usernameInput) {
      message.style.color = "red";
      message.innerText = "Enter a username";
      return;
    }

    const email = usernameInput + "@camp.local";

    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        message.style.color = "green";
        message.innerText = "Logged in!";
        document.getElementById("loginUI").style.display = "none";
        document.getElementById("uploadUI").style.display = "block";
        displayCurrentImage();
      })
      .catch(err => {
        message.style.color = "red";
        message.innerText =
          err.code === "auth/wrong-password" ? "Invalid password" :
          err.code === "auth/user-not-found" ? "User does not exist" :
          "Login failed";
      });
  }

  // --- UPLOAD IMAGE ---
  function uploadImage() {
    const fileInput = document.getElementById("imageInput");
    const file = fileInput.files[0];
    const msg = document.getElementById("uploadMessage");

    if (!file) {
      msg.style.color = "red";
      msg.innerText = "Select a PNG file first";
      return;
    }

    if (!auth.currentUser) {
      msg.style.color = "red";
      msg.innerText = "You must log in first";
      return;
    }

    // Always overwrite the same file
    const storageRef = storage.ref('programming/current.png');

    storageRef.put(file)
      .then(() => {
        msg.style.color = "green";
        msg.innerText = "PNG uploaded successfully!";
        fileInput.value = "";
        displayCurrentImage();
      })
      .catch(err => {
        console.error(err);
        msg.style.color = "red";
        msg.innerText = "Upload failed";
      });
  }

  // --- DISPLAY CURRENT IMAGE ---
  function displayCurrentImage() {
    const displayDiv = document.getElementById("imageDisplay");
    const fileRef = storage.ref('programming/current.png');

    fileRef.getDownloadURL()
      .then(url => {
        displayDiv.innerHTML = `<img src="${url}?t=${new Date().getTime()}">`;
      })
      .catch(() => {
        displayDiv.innerHTML = "<p>No programming uploaded yet.</p>";
      });
  }
</script>

</body>
</html>
